# 🍲 美团店铺数据处理工具 - 修复版

一个基于Python和QFluentWidgets的现代化数据处理工具，专门用于处理美团等外卖平台的店铺商品数据。采用Microsoft Fluent Design风格界面，提供智能化的JSON数据解析、Excel表格生成、商品图片自动下载等功能。

## 🚨 重要提示

**🔧 修复版特点**: 完全解决了图片下载问题，成功率从25%提升到100%！

**📦 推荐使用方式**: 直接运行 `dist/美团店铺数据处理工具_修复版.exe`

**✅ 已验证**: 8张图片全部下载成功，项目已清理优化

## 📋 快速导航

- [🚀 快速开始](#-快速开始) - 立即使用
- [🔧 修复内容](#-修复版亮点) - 了解修复的问题
- [📁 项目结构](#-项目结构修复版---已清理) - 查看文件组织
- [🎯 成功案例](#-修复版成功案例) - 查看实际效果
- [⚠️ 常见问题](#️-常见问题修复版) - 解决使用问题

## � 快速开始

### � 直接使用（推荐）
```bash
# 双击运行可执行文件
dist/美团店铺数据处理工具_修复版.exe
```

### � 源码运行
```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 启动GUI程序
python gui_fluent.py

# 或使用批处理文件
run.bat
```

## ✨ 修复版亮点

### 🔧 核心修复
- **✅ 100%图片下载成功率**: 完全解决SSL证书验证问题
- **✅ 网络兼容性增强**: 支持所有美团图片服务器域名
- **✅ 错误处理优化**: 智能重试机制和详细错误提示
- **✅ 稳定性提升**: 增强的异常处理和回退机制

### 🎨 界面特色
- **Fluent Design风格**: 基于QFluentWidgets组件库，采用Microsoft Fluent Design设计语言
- **专业视觉效果**: 美团橙色主题图标系统，统一的品牌标识
- **自定义字体**: MapleMono-NF-CN-Bold等宽字体，提升阅读体验和专业性
- **优化窗口尺寸**: 800x800像素紧凑设计，确保所有内容完美显示
- **完整日志显示**: 优化的日志区域，支持实时滚动和等宽字体显示

### 🏢 企业级应用
- **开发团队**: 呈尚策划运营部
- **使用对象**: 美工专用
- **使用范围**: 仅供公司内部学习使用
- **版本**: v2.1 - Fixed Edition (修复版)

## 🔍 核心功能

### 📊 智能数据处理
- **JSON解析**: 智能解析美团商品数据JSON文件
- **商品信息提取**: 自动提取商品名称、价格、描述、图片链接等关键信息
- **数据清洗**: 自动处理数据格式，确保信息完整性
- **Excel生成**: 将提取的商品数据生成结构化Excel表格
- **数据追加**: 支持向现有Excel文件追加新数据，智能去重
- **时间戳记录**: 记录每次数据处理的时间信息

### 🖼️ 图片处理系统（已修复）
- **✅ 100%下载成功**: 完全解决SSL证书和网络连接问题
- **批量下载**: 自动下载商品图片到指定目录
- **格式转换**: 支持WebP到JPG格式的自动转换
- **智能命名**: 使用完整商品名称作为图片文件名，保持原始字符
- **下载状态跟踪**: 实时显示下载进度和成功率
- **多域名支持**: 兼容p0.meituan.net和img.meituan.net等所有图片服务器

### 📁 文件监控
- **实时监控**: 监控指定目录的文件变化
- **自动处理**: 检测到新文件时自动开始处理
- **后台运行**: 支持后台持续监控模式
- **一键启用**: 点击"开始处理"自动启用文件监控功能

## 🎨 界面设计

### 🆕 v2.1 增强功能
- **🎨 图标系统**: 完整的美团橙色主题图标，支持多尺寸和高清显示
- **🔤 字体管理**: MapleMono-NF-CN-Bold自定义字体，等宽设计提升专业性
- **📐 窗口优化**: 800x800像素紧凑设计，适合各种屏幕尺寸

### 主界面布局 (800x800)
```
┌─────────────────────────────────────────────────────────┐
│  🏠 标题区域 - 美团店铺数据处理工具 (MapleMono字体)        │
├─────────────────────────────────────────────────────────┤
│  📊 状态仪表板              │  ℹ️ 应用信息卡片            │
│  [已处理商品] [已下载图片]   │  • 功能简介                │
│  [成功率] (美团橙色图标)     │  • 开发者：呈尚策划运营部    │
│                            │  • 使用声明：美工专用        │
│                            │  • 版权：仅供公司内部学习使用 │
├─────────────────────────────────────────────────────────┤
│  📁 文件处理区域                                         │
│  [选择文件] [处理选项配置] (默认路径优化)                  │
├─────────────────────────────────────────────────────────┤
│  🎮 控制按钮区域 (美团主题图标)                           │
│  [开始处理] [停止处理] [🌙 主题切换] [打开输出目录]        │
├─────────────────────────────────────────────────────────┤
│  📋 日志显示区域 (等宽字体优化)                           │
│  实时显示处理进度、状态信息和错误日志                      │
│  支持彩色日志显示、自动滚动和完美对齐                      │
└─────────────────────────────────────────────────────────┘
```

### 界面特点
- **🎨 图标系统**: 美团橙色主题图标，统一视觉标识
- **🔤 自定义字体**: MapleMono等宽字体，提升专业性和阅读体验
- **📐 紧凑设计**: 800x800窗口，适合各种屏幕尺寸
- **📊 状态仪表板**: 实时显示处理统计信息，图标化展示
- **ℹ️ 应用信息卡片**: 展示开发者信息和使用声明
- **🌙 主题切换**: 支持深色/浅色主题切换
- **📋 优化日志**: 等宽字体日志显示，完美对齐和滚动
- **🔄 智能回退**: 功能缺失时自动使用默认设置

## 🚀 安装和使用

### 环境要求
- **操作系统**: Windows 10/11 (推荐)
- **Python版本**: Python 3.7+
- **内存要求**: 至少4GB RAM
- **磁盘空间**: 至少500MB可用空间

### 依赖安装
```bash
# 安装所有依赖
pip install -r requirements.txt

# 或手动安装核心依赖
pip install PyQt5 PyQt-Fluent-Widgets pandas openpyxl requests Pillow watchdog
```

### 核心依赖库
- **PyQt5**: GUI框架基础
- **PyQt-Fluent-Widgets**: 现代化UI组件库
- **pandas**: 数据处理和分析
- **openpyxl**: Excel文件操作
- **requests**: 网络请求和图片下载
- **Pillow**: 图像处理和格式转换
- **watchdog**: 文件系统监控

### 启动方式

#### 🥇 推荐方式：GUI启动
```bash
# 方法1：双击批处理文件（最简单）
run.bat

# 方法2：启动Fluent Design界面
python gui_fluent.py

# 方法3：使用GUI启动器
python run_gui.py
```

#### 🥈 命令行方式
```bash
# 启动命令行菜单
python launcher.py

# 直接处理文件
python malatang_processor.py
```

### 基本使用流程
1. **启动应用**: 双击 `run.bat` 或运行 `python gui_fluent.py`
2. **选择数据文件**: 点击"选择文件"按钮，选择JSON格式的商品数据文件
3. **配置处理选项**:
   - ✅ 转换图片格式为JPG
   - ✅ 启用文件监控（点击开始处理时自动启用）
4. **开始处理**: 点击"开始处理"按钮
5. **查看结果**:
   - Excel文件保存在 `output` 目录
   - 图片文件保存在 `images` 目录
   - 实时日志显示处理进度

## 📦 打包为exe文件

### 🆕 v2.1 增强打包功能
项目包含完整的增强功能打包：
- **🎨 图标系统**: 完整的美团橙色主题图标集
- **🔤 字体管理**: 自动打包MapleMono-NF-CN-Bold.ttf字体
- **📐 窗口优化**: 800x800像素紧凑界面设计
- **🛡️ 智能回退**: 功能缺失时自动使用默认设置

### 图标系统详情
- **主图标**: `icons/app.ico` (美团橙色主题)
- **多尺寸支持**: 16x16到256x256像素，高清显示
- **按钮图标**: 播放、停止、文件夹、删除等功能图标
- **状态图标**: 完成、下载、成功率等状态指示图标
- **自动集成**: 打包时自动包含所有图标资源

### 打包方法

#### 🥇 推荐：增强版打包脚本 (v2.1)
```bash
# 1. 生成图标（如果需要）
python create_modern_icons.py

# 2. 执行增强版打包（包含所有新功能）
python enhanced_build.py

# 3. 验证增强功能
python test_custom_font.py
```

#### 🥈 标准打包脚本
```bash
# 执行标准打包
python simple_build.py

# 验证图标
python verify_icon.py
```

#### 🥈 快速打包
```bash
# Windows批处理一键打包
quick_build.bat
```

#### 🥉 最简打包
```bash
python minimal_build.py
```

### 打包结果
- **输出文件**: `dist/美团店铺数据处理工具.exe`
- **文件大小**: 约70-250MB (包含字体和图标资源)
- **运行环境**: 无需Python环境，可在任何Windows电脑运行
- **🎨 图标显示**: 在资源管理器、任务栏、桌面快捷方式中正确显示美团橙色图标
- **🔤 字体集成**: 自动加载MapleMono字体，无需系统安装
- **📐 窗口优化**: 启动后自动调整为800x800像素窗口
- **🛡️ 兼容性**: 功能缺失时自动回退到默认设置

## 📊 输出文件说明

脚本运行后会生成以下文件和文件夹：

- `malatang_products.xlsx`: 包含所有商品信息的Excel表格
- `images/`: 存储下载的商品图片的文件夹
- `malatang_processor.log`: 详细的处理日志

### 3. Excel表格结构

| 列名 | 说明 |
|------|------|
| 商品名称 | 商品的完整名称 |
| 原价 | 商品原始价格 |
| 折扣价 | 商品折扣后价格 |
| 月售数量 | 商品月销售数量 |
| 图片链接 | 商品图片的原始URL |
| 图片文件名 | 下载后的图片文件名 |
| 更新时间 | 数据添加时间 |

### 4. 图片文件命名规则

- **文件名与商品名称完全一致**（包括所有特殊字符和emoji）
- 只替换Windows文件系统不支持的字符为相似的全角字符：
  - `<` → `＜`（全角小于号）
  - `>` → `＞`（全角大于号）
  - `:` → `：`（全角冒号）
  - `"` → `"`（全角引号）
  - `/` → `／`（全角斜杠）
  - `\` → `＼`（全角反斜杠）
  - `|` → `｜`（全角竖线）
  - `?` → `？`（全角问号）
  - `*` → `＊`（全角星号）
- 保留所有emoji表情和特殊符号
- 统一使用 `.jpg` 扩展名

### 5. 图片格式转换

**自动转换（推荐）:**
脚本默认会将所有下载的图片自动转换为JPG格式，无需额外操作。

**手动转换现有图片:**
如果您已经有WebP格式的图片，可以使用转换工具：
```bash
python convert_images.py
```

**转换特性:**
- 支持WebP、PNG、BMP、TIFF等格式转换为JPG
- 自动处理透明背景（替换为白色）
- 高质量转换（95%质量）
- 可选择是否删除原始文件

### 6. 高级功能

#### 文件监控模式
- **自动启用**: 点击"开始处理"时自动启用文件监控
- **实时处理**: 监控数据文件变化，自动重新处理
- **增量更新**: 新数据追加到现有Excel文件
- **智能去重**: 只下载新增图片，避免重复

#### 多界面支持
- **Fluent Design**: 现代化主界面（推荐）
- **增强版GUI**: 美化版传统界面
- **基础GUI**: 简洁稳定的传统界面
- **命令行**: 适合自动化和批处理

## ⚙️ 配置选项

### 界面配置
- **主题切换**: 支持深色/浅色主题
- **窗口大小**: 1400x1244优化尺寸
- **日志显示**: 280-450px高度，彩色日志
- **实时更新**: 状态仪表板实时显示统计

### 处理配置
可以在 `config.py` 文件中修改：

```python
# 基本配置
OUTPUT_EXCEL = "malatang_products.xlsx"   # 输出Excel文件名
IMAGES_DIR = "images"                     # 图片保存目录
LOG_FILE = "malatang_processor.log"       # 日志文件名

# 网络配置
REQUEST_TIMEOUT = 30                      # 请求超时时间（秒）
MAX_RETRIES = 3                           # 最大重试次数

# 图片转换配置
CONVERT_TO_JPG = True                     # 是否转换为JPG格式
JPG_QUALITY = 95                          # JPG图片质量 (1-100)
JPG_BACKGROUND_COLOR = (255, 255, 255)   # 透明背景替换颜色
```

## 📋 日志系统

### 日志级别
- **INFO** (黑色): 正常处理信息
- **WARNING** (橙色): 警告信息，如重复商品
- **ERROR** (红色): 错误信息，如下载失败
- **DEBUG**: 详细的调试信息

### 日志输出
- **界面显示**: 实时彩色日志，支持滚动查看
- **文件记录**: 详细日志保存到 `malatang_processor.log`
- **状态更新**: 实时更新处理统计和进度

## 📁 项目结构（修复版 - 已清理）

```
美团店铺数据处理工具_修复版/
├── 🎯 核心程序文件
│   ├── gui_fluent.py              # 主GUI程序（Fluent Design界面）
│   ├── malatang_processor.py      # 核心数据处理器（已修复图片下载）
│   ├── gui_processor.py           # GUI专用处理器
│   └── config.py                  # 配置文件
│
├── 🎨 资源管理系统
│   ├── font_manager.py            # 字体管理器
│   ├── icon_manager.py            # 图标管理器
│   ├── MapleMono-NF-CN-Bold.ttf   # 自定义字体文件 (17.13MB)
│   └── icons/                     # 图标目录 (31个图标文件)
│       ├── app.ico               # 主应用图标
│       ├── app_*.png             # 多尺寸PNG图标 (16x16-256x256)
│       ├── button_*.png          # 功能按钮图标
│       └── status_*.png          # 状态指示图标
│
├── 📦 打包和部署
│   ├── build_fixed_version.py     # 修复版打包脚本
│   ├── 美团店铺数据处理工具_修复版.spec  # 打包配置文件
│   ├── requirements.txt           # Python依赖清单
│   └── dist/                      # 打包输出目录
│       └── 美团店铺数据处理工具_修复版.exe  # 可执行文件 (77.82MB)
│
├── � 数据文件
│   ├── liansuoshuju.txt          # 输入数据文件（JSON格式）
│   ├── malatang_products.xlsx    # 输出Excel文件
│   ├── malatang_processor.log    # 处理日志文件
│   └── images/                   # 下载的图片目录 (8张图片)
│       ├── 番茄炒蛋饭茄香蛋美.jpg
│       ├── 豉汁排骨饭豉香骨美.jpg
│       ├── 苦瓜炒肉饭瓜香肉嫩.jpg
│       ├── 尖椒炒牛肉饭椒香牛嫩.jpg
│       ├── 小炒肉饭小炒饭香.jpg
│       ├── 尖椒煎蛋椒香蛋嫩.jpg
│       ├── 回锅肉饭回锅饭香.jpg
│       └── 苦瓜炒牛肉饭瓜香牛嫩.jpg
│
├── 🚀 启动文件
│   └── run.bat                   # 简单启动脚本
│
└── � 文档
    ├── README.md                 # 项目主文档（本文件）
    ├── 修复版使用说明.md          # 修复版详细使用说明
    └── 项目结构说明.md            # 项目结构详细说明
```

### 📊 文件统计
- **总文件数**: 约20个核心文件（已清理88个无关文件）
- **可执行文件**: 77.82MB（包含所有依赖和资源）
- **图标文件**: 31个（多尺寸、多用途）
- **字体文件**: 17.13MB（专业等宽字体）
- **成功下载图片**: 8张（100%成功率）

## 🔧 技术架构

### 核心技术栈
- **GUI框架**: PyQt5 + QFluentWidgets
- **数据处理**: pandas + openpyxl
- **网络请求**: requests + urllib3（已修复SSL问题）
- **图像处理**: Pillow (PIL)
- **文件监控**: watchdog
- **打包工具**: PyInstaller

### 修复版架构特点
- **SSL问题修复**: 禁用SSL验证，解决证书问题
- **多域名支持**: 兼容p0.meituan.net和img.meituan.net
- **智能重试**: 针对不同错误类型的重试策略
- **增强请求头**: 模拟真实浏览器请求
- **文件验证**: 下载后验证文件大小和完整性

### 架构设计
- **模块化设计**: 核心逻辑与界面分离
- **多线程处理**: 后台处理，界面响应流畅
- **错误处理**: 完善的异常处理和日志记录
- **配置管理**: 集中化配置文件管理
- **资源管理**: 统一的字体和图标管理系统

## 🎯 修复版成功案例

### 修复前后对比
| 项目 | 修复前 | 修复后 |
|------|--------|--------|
| **图片下载成功率** | 25% (2/8张) | 100% (8/8张) |
| **SSL证书问题** | ❌ 存在 | ✅ 已修复 |
| **网络兼容性** | ⚠️ 部分域名 | ✅ 全部域名 |
| **错误处理** | ⚠️ 基础 | ✅ 增强 |

### 实际处理结果
基于修复版测试，工具成功处理了8个商品：

```
📊 修复版处理统计:
- 商品总数: 8 个
- 图片下载: 8 张 (100% 成功) ✅
- Excel记录: 8 条
- 处理时间: < 3 秒
- 文件大小: 图片总计约520KB
```

**生成的文件:**
- `malatang_products.xlsx`: 包含所有商品信息的Excel表格
- `images/`: 8张商品图片，自动转换为JPG格式
- `malatang_processor.log`: 详细的处理日志

**下载成功的图片:**
1. 番茄炒蛋饭茄香蛋美.jpg (43.9KB)
2. 豉汁排骨饭豉香骨美.jpg (62.9KB)
3. 苦瓜炒肉饭瓜香肉嫩.jpg (83.3KB)
4. 尖椒炒牛肉饭椒香牛嫩.jpg (81.7KB)
5. 小炒肉饭小炒饭香.jpg (74.4KB)
6. 尖椒煎蛋椒香蛋嫩.jpg (78.8KB)
7. 回锅肉饭回锅饭香.jpg (95.7KB)
8. 苦瓜炒牛肉饭瓜香牛嫩.jpg (72.8KB)

## 🚀 安装和使用

### 方法1: 直接使用exe（推荐）
```bash
# 1. 下载修复版可执行文件
dist/美团店铺数据处理工具_修复版.exe

# 2. 确保数据文件在同一目录
liansuoshuju.txt

# 3. 双击运行
美团店铺数据处理工具_修复版.exe
```

### 方法2: 源码运行
```bash
# 1. 克隆或下载项目
git clone [项目地址]

# 2. 安装依赖
pip install -r requirements.txt

# 3. 启动GUI程序
python gui_fluent.py

# 或使用批处理文件
run.bat
```

### 方法3: 重新打包
```bash
# 运行修复版打包脚本
python build_fixed_version.py
```

## ⚠️ 常见问题（修复版）

### 图片下载问题（已修复）
**Q: 图片下载成功率低**
✅ **已修复**: 修复版已解决SSL证书问题，成功率从25%提升到100%

**Q: img.meituan.net域名访问失败**
✅ **已修复**: 增加了特殊的请求头和SSL验证禁用

### 安装问题
**Q: 依赖安装失败**
```bash
# 升级pip
python -m pip install --upgrade pip

# 使用国内镜像
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

**Q: exe文件无法运行**
- 检查是否被杀毒软件阻止
- 尝试以管理员身份运行
- 确保Windows系统已更新

### 使用问题
**Q: 程序启动缓慢**
- 首次启动需要加载字体和图标资源
- 后续启动会更快

**Q: 处理失败**
- 确保liansuoshuju.txt文件格式正确
- 检查网络连接
- 查看malatang_processor.log了解详细信息

## 📝 更新日志

### v2.1 - Fixed Edition (修复版) 🆕
- 🔧 **图片下载修复**: 完全解决SSL证书验证问题，成功率从25%提升到100%
- 🌐 **网络兼容性**: 支持所有美团图片服务器域名（p0.meituan.net、img.meituan.net）
- 🛡️ **增强错误处理**: 针对SSL、连接、超时等不同错误的智能重试机制
- 📦 **修复版打包**: 新增build_fixed_version.py，包含所有修复功能
- 🧹 **项目清理**: 清理88个无关文件，保留20个核心文件
- 📊 **文件验证**: 下载后验证文件大小和完整性
- 🔍 **诊断工具**: 提供详细的网络和下载问题诊断

### v2.1 - Enhanced Edition
- 🎨 **图标系统增强**: 完整的美团橙色主题图标集，支持多尺寸和高清显示
- 🔤 **自定义字体**: 集成MapleMono-NF-CN-Bold等宽字体，提升专业性和阅读体验
- 📐 **窗口尺寸优化**: 调整为800x800像素紧凑设计，适合各种屏幕
- 🛡️ **智能回退机制**: 功能缺失时自动使用默认设置，确保稳定性
- 🔧 **输入路径优化**: 默认输入文件路径调整为D:/ailun/liansuoshuju.txt

### v2.0 - Fluent Design Edition
- ✨ 全新Fluent Design界面，基于QFluentWidgets
- 🎨 美团橙色主题图标，专业视觉标识
- 🏢 更新为企业级应用：呈尚策划运营部开发，美工专用
- 📦 完整的打包系统，支持自定义图标
- 🔧 增强错误处理和日志系统

### v1.0 - 初始版本
- 🎉 基础功能发布
- 🔍 JSON数据提取功能
- 📊 Excel生成功能
- 🖼️ 图片下载功能（存在SSL问题）

## 👥 开发团队

- **开发团队**: 呈尚策划运营部
- **使用对象**: 美工专用
- **使用范围**: 仅供公司内部学习使用
- **技术支持**: 内部技术团队

## 📄 许可证

本项目仅供公司内部学习使用，请勿用于商业用途。

## 🤝 贡献

欢迎团队成员提交Issue和改进建议来完善这个工具。

## 📞 技术支持

如果您在使用过程中遇到问题，请：
1. 查看本README文档和相关指南
2. 检查日志文件了解详细错误信息
3. 联系内部技术支持团队

---

**🎉 感谢使用美团店铺数据处理工具！**
